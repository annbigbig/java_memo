package com.kashu.test.repository;

import java.util.List;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;
import com.kashu.test.domain.User;

@Repository("userRepository")
@Transactional
public class UserRepositoryImpl implements UserRepository {
	@PersistenceContext
	private EntityManager manager;

	@Override
	public User findByUsername(String username) {
		return manager.find(User.class, username);
	}

	@Override
	public User save(User user) {
		//try{
		  manager.persist(user);
		//}catch(Exception e){
			//user = null;
			//e.printStackTrace();
			//System.out.println(e.getMessage());
		//}
		return user;
	}
	
	@Override
	public User update(User user){
		//manager.getEntityManagerFactory().getCache().evictAll();
		manager.merge(user);
		//manager.refresh(user);
		//manager.flush();
		//manager.getTransaction().begin();
		//User managedUser = manager.find(User.class, user.getUsername());  //working1
		//managedUser.setAddress("我家就在士東路333號");  //working2
		//manager.getTransaction().commit();
		//manager.flush();  //working3
		//return managedUser; //working4
		return user;
	}

	@Override
	public List<User> getAllUsers() {
		 List<User> users = manager.createQuery("Select u From User u", User.class).getResultList();
    return users;
	}

}
